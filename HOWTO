vi:sw=4:ts=4:ai:sm:et:wm=10

======================================================================
Introduction

The documentation for McFeely is a bit spread out and confusing. This
document attempts to alleviate some of the confusion by providing a
step by step guide to installing (from RPM) and then running a mcfeely
server and client installation. 

In its first draft this document will only describe the client and
server on a local box without ssh being involved. Discussion about use
with ssh will be added later.

If you have any questions about this, please subscribe to the
mcfeely-l@systhug.com mailing list by sending mail to
mcfeely-l-subscribe@systhug.com.

======================================================================
Installation

To install you will need the following rpms:

  mcfeely-client
  mcfeely-server
  mcfeely-common
  knetstring

You should be able to find all of these in the mcfeely distribution 
directory at http://web.systhug.com/mcfeely/dist/

knetstring provides the shared library used by the client and server
to talk with one another. 

Before you install the rpms, create the user and groups which McFeely
needs to run.

ALSO: because of some weirdness with installing perl modules from RPMS
on different versions of Redhat you may find that you need to do the
following to make the perl modules that McFeely will install visible
to your system:

   cd /usr/lib/perl5/site_perl
   cp -a 5.005/* .
   rm -r 5.005
   ln -s . 5.005

YOU MAKE THESE SORTS OF CHANGES AT YOUR OWN RISK. MAKE SURE YOU KNOW
WHAT YOU ARE DOING!

-  create a mcfeely user with a home of /opt/mcfeely and /bin/bash
   as its shell
-  create a mcfeely group, this is the group the server runs as
-  create a mcqueue group. To this group add users who you wish to
   allow to enqueue mcfeely jobs. You don't want to do this all
   will nilly, think before you act. We suggest that you don't add
   anyone to this group until after you have completed your testing
   and are familiar with the system.

The mcfeely server is a continuously running processes so should
therefore start at boot time and run continuously from there. At this
time no initscripts are provided. They are in the works. To start
things run:

   /opt/mcfeely/bin/mcfeely-start

This program will log to STDERR so you may want to catch that.

For the client side you need to run mcfeely-ttpd, it also logs to
STDERR. mcfeely-ttpd needs a friend to help it listen on port 757. A
tool like tcpserver from Dan Bernstein (of qmail fame) should do the
trick. It seems like it should work from inetd, but I haven't been
able to get that to work.

In /opt/mcfeely/control create a file called 'hosts' that is owned by
root and is 644. In there put the information about the mcfeely
clients.

saliva.kiva.net saliva   757        206.97.64.58

The fields are client, server, port, secret-file. By convention, the
secret-file is the IP of the client. (Replace 'saliva' with your
host). Newer versions of the McFeely API do things based on full
hostname.

Next, we need to create a secret that is to be shared between the
client and the server. A program, /opt/mcfeely/bin/secretmaker, will
create a file called newsecret in the current directory. Copy that to
/opt/mcfeely/control/mysecret and
/opt/mcfeely/control/secrets/<secret-file-name>.

These files should be owned by root and group mcfeely, mode 640.

======================================================================
Testing

In one window start up mcfeely-ttpd (the client) with tcpserver (do
this as root):

/usr/local/bin/tcpserver -c8 -v -g 0 -u 0 scalding.bton.kiva.net 757 \
   /opt/mcfeely/bin/mcfeely-ttpd

replacing the hostname with your hostname.

In another window start up mcfeely (the server) by running this
command (as root):

  /opt/mcfeely/bin/mcfeely-start

In another window run:

  /opt/mcfeely/bin/hostcheck.pl

Give your local client's name as the host and test_comm as the comm:

  [root@cold /root]# /opt/mcfeely/bin/hostcheck.pl 
  Hostname? [] scalding
  Comm? [] test_comm
  Args? [] 1

If everything is working you should recieve a mail message to 'root'
stating success. The mcfeely-start window will include some logging
information, as will the mcfeely-ttpd window.
